<div class="report-card">


  <!-- Income/Expense Stats -->
  <div class="stats-section">
    <div class="stat-card income-stat">
      <div class="stat-content">
        <div class="stat-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 19V5m-7 7l7 7 7-7" />
          </svg>
        </div>
        <span class="stat-label">{{ 'home.income' | translate }}</span>
      </div>
      <span class="stat-value">{{ processedIncome | money }} so'm</span>
    </div>

    <div class="stat-card expense-stat">

      <div class="stat-content">
        <div class="stat-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 5v14m-7-7l7-7 7 7" />
          </svg>
        </div>
        <span class="stat-label">{{ 'home.expenses' | translate }}</span>
      </div>
      <span class="stat-value">{{ processedExpenses | money }} so'm</span>

    </div>
  </div>

  <!-- Filter Buttons -->
  <div class="filter-section" *ngIf="showFilters">
    <button class="clean-btn" (click)="clearAllFilters()">
      <img src="assets/img/clean.svg" alt="clean">
    </button>
    <button class="filter-btn" [class.active]="showTransactionTypeModal || isFilterActive()"
      (click)="openTransactionTypeModal()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01" />
      </svg>
      {{ 'home.operations' | translate }}
    </button>
    <button class="filter-btn" [class.active]="showDateRangeModal || isDateRangeActive()"
      (click)="openDateRangeModal()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
        <path d="M16 2v4M8 2v4M3 10h18" />
      </svg>
      {{ 'common.period' | translate }}
    </button>
    <button class="filter-btn" [class.active]="showCardFilterModal || isCardFilterActive()"
      (click)="openCardFilterModal()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        <rect x="1" y="4" width="22" height="16" rx="2" ry="2" />
        <path d="M1 10h22" />
      </svg>
      {{ 'home.cardAndAccounts' | translate }}
    </button>
  </div>

  <!-- Transaction Type Modal -->
  <app-transaction-type-modal [isOpen]="showTransactionTypeModal" [selectedType]="selectedFilterType"
    (close)="closeTransactionTypeModal()" (apply)="onFilterApply($event)">
  </app-transaction-type-modal>

  <!-- Date Range Modal -->
  <app-date-range-modal [isOpen]="showDateRangeModal" [startDate]="selectedStartDate" [endDate]="selectedEndDate"
    (close)="closeDateRangeModal()" (apply)="onDateRangeApply($event)">
  </app-date-range-modal>

  <!-- Card Filter Modal -->
  <app-card-filter-modal [isOpen]="showCardFilterModal" [selectedCardId]="selectedCardId"
    (close)="closeCardFilterModal()" (apply)="onCardFilterApply($event)">
  </app-card-filter-modal>

  <!-- Transactions -->
  <div class="transactions-section">
    <div class="section-header">
      <h3 class="section-title">{{ 'home.recentTransactions' | translate }}</h3>
      <button class="see-all-btn" *ngIf="showSeeAll" (click)="onSeeAllClick()">{{ 'home.seeAll' | translate }}</button>
    </div>

    <div class="transactions-container" [class.limited-transactions]="maxTransactions">
      <div class="date-group" *ngFor="let group of groupedTransactions">
        <div class="date-header">{{ group.date }}</div>

        <div class="transaction-item" *ngFor="let transaction of group.transactions"
          (click)="openTransactionDetails(transaction)">

          <div class="transaction-top-row">
            <div class="transaction-type" [ngClass]="transaction.type === 'income' ? 'income-type' : 'expense-type'">
              <div class="transaction-icon">
                <div class="income-stat" *ngIf="transaction.type === 'income'">
                  <div class="stat-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                      stroke-linecap="round" stroke-linejoin="round">
                      <path d="M12 19V5m-7 7l7 7 7-7" />
                    </svg>
                  </div>
                </div>

                <div class="expense-stat" *ngIf="transaction.type !== 'income'">
                  <div class="stat-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                      stroke-linecap="round" stroke-linejoin="round">
                      <path d="M12 5v14m-7-7l7-7 7 7" />
                    </svg>
                  </div>
                </div>
              </div>
              <span>{{ transaction.merchantName }}</span>
            </div>
            <div class="transaction-time">{{ transaction.time }}</div>
          </div>

          <!-- Bottom row: Card logo/number and Amount -->
          <div class="transaction-bottom-row">
            <div class="transaction-card">
              <img *ngIf="transaction.bankLogoMini" [src]="transaction.bankLogoMini" alt="Card" class="card-icon"
                width="16" height="16" />
              <svg *ngIf="!transaction.bankLogoMini" width="16" height="16" viewBox="0 0 24 24" fill="none"
                class="card-icon">
                <circle cx="12" cy="12" r="10" fill="#2563EB" />
                <text x="12" y="16" text-anchor="middle" fill="white" font-size="10" font-weight="bold">U</text>
              </svg>
              <span>{{ transaction.cardNumber }}</span>
            </div>
            <div class="transaction-amount" [ngClass]="transaction.type === 'income' ? 'positive' : 'negative'">
              {{ transaction.type === 'income' ? '+' : '-' }}{{ getAbsoluteValue(transaction.amount) | money }}<span>
                so'm</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading more indicator -->
    <div class="loading-more" *ngIf="loadingMore">
      <div class="loading-spinner"></div>
      <span>{{ 'common.loading' | translate }}</span>
    </div>

    <!-- Scroll sentinel for infinite scroll -->
    <div #scrollSentinel class="scroll-sentinel" *ngIf="enableInfiniteScroll && hasMore"></div>
  </div>

  <!-- Transaction Details Modal -->
  <app-transaction-details-modal [isOpen]="showTransactionDetailsModal" [transaction]="selectedTransaction"
    (close)="closeTransactionDetailsModal()">
  </app-transaction-details-modal>
</div>