<div class="screen chart-screen">
  <div class="screen-header">
    <button class="back-btn" (click)="goBack()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7" />
      </svg>
    </button>
    <h2>{{ 'chart.title' | translate }}</h2>
    <div class="spacer"></div>
  </div>

  <!-- Month Selector -->
  <div class="month-selector">
    <button *ngFor="let month of months; let i = index" class="month-btn" [class.active]="i === selectedMonthIndex"
      (click)="selectMonth(i)">
      {{ month.name }}
    </button>
  </div>

  <!-- Loading State -->
  <app-loading-state *ngIf="isLoading"></app-loading-state>

  <!-- Chart Content -->
  <div *ngIf="!isLoading" class="chart-content">
    <!-- ECharts Donut -->
    <div class="donut-chart-container" *ngIf="categories.length > 0">
      <div echarts [options]="chartOption" class="echart"></div>
    </div>

    <!-- Empty State -->
    <div *ngIf="categories.length === 0">
      <app-empty-state></app-empty-state>
    </div>

    <!-- Category List -->
    <div class="category-list" *ngIf="categories.length > 0">
      <div class="category-item" *ngFor="let cat of categories">
        <div class="category-icon" [style.background-color]="cat.color + '20'">
          <img *ngIf="cat.mccLogoUrl" [src]="cat.mccLogoUrl" alt="">
          <span *ngIf="!cat.mccLogoUrl" class="icon-placeholder" [style.color]="cat.color">
            {{ cat.categoryDescription?.charAt(0) || '?' }}
          </span>
        </div>
        <span class="category-name">{{ cat.categoryDescription }}</span>
        <span class="category-percentage">{{ cat.percentage }}%</span>
      </div>
    </div>
  </div>
</div>